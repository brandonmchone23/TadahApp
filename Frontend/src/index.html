<!DOCTYPE html>
<html>
<head>
  <title>User Login</title>
</head>
<body>
<h2>User Login</h2>
<form id="login-form">
  <div>
    <label for="username">Username:</label>
    <input type="text" id="username" name="username" required>
  </div>
  <div>
    <input type="submit" value="Login">
  </div>
</form>
<div id="response-container"></div>

<script>
  document.getElementById('login-form').addEventListener('submit', checkUsername);

  function checkUsername(event) {
    event.preventDefault(); // Prevent form submission

    const enteredUsername = document.getElementById('username').value;

    // Remove event listener to prevent multiple submissions
    document.getElementById('login-form').removeEventListener('submit', checkUsername);

    // Make fetch request to check if parent username exists
    fetch('/parents/' + enteredUsername)
            .then(response => {
              if (response.ok) {
                return response.json();
              } else if (response.status === 404) {
                throw new Error('Username does not exist! Please try again.');
              } else {
                throw new Error('An error occurred while checking the username. Please try again later.');
              }
            })
            .then(data => {
              const parentUsername = data.parentUsername;
              const childUsername = data.childUsername;
              const responseContainer = document.getElementById('response-container');
              responseContainer.textContent = `Username exists in parent records! You can proceed with the login as a parent. Child Username: ${childUsername}`;
              // Perform parent login logic or redirect to another page

              // Redirect to the task list page with both child and parent usernames
              window.location.href = `tasklist.html?childUsername=${childUsername}&parentUsername=${parentUsername}`;
            })
            .catch(error => {
              const responseContainer = document.getElementById('response-container');
              responseContainer.textContent = error.message;
              // Clear the input field or perform any other desired action
            });
  }
</script>
</body>
</html>
